<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JasoNowitzki Daily Knee Routine</title>
<style>
:root {
  --bg:#0d1117; --card:#10151b; --neon-blue:#00bfff; --neon-green:#39ff14; --neon-red:#ff3b3b; --muted:#9aa6b2;
}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#e6eef3;}
.app{max-width:720px;margin:auto;padding:12px;display:flex;flex-direction:column;min-height:100vh;}
header{display:flex;align-items:center;gap:12px;margin-bottom:8px;}
.logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(180deg,var(--neon-blue),#00d4ff);display:flex;align-items:center;justify-content:center;font-weight:800;color:#041617;}
h1{margin:0;font-size:1.05rem;color:var(--neon-blue);}
.lead{color:var(--muted);font-size:.92rem;margin-top:4px;}
.card{background:linear-gradient(180deg,var(--card),#0b1216);border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6);}
.tabs{display:flex;gap:6px;position:fixed;left:0;right:0;bottom:10px;max-width:720px;margin:auto;padding:8px;background:transparent;justify-content:space-around;}
.tab-btn{flex:1;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);color:var(--muted);font-weight:700;}
.tab-btn.active{background:linear-gradient(90deg,var(--neon-blue),var(--neon-green));color:#011;box-shadow:0 8px 30px rgba(0,191,255,0.12);}
.panel{display:none;flex:1;min-height:60vh;margin-bottom:70px;}
.panel.active{display:block;}
.row{display:flex;gap:8px;margin-top:10px;}
.btn{padding:10px;border-radius:10px;border:0;font-weight:700;cursor:pointer;}
.btn.blue{background:var(--neon-blue);color:#031;box-shadow:0 8px 28px rgba(0,191,255,0.12);}
.btn.red{background:var(--neon-red);color:#201010;box-shadow:0 8px 28px rgba(255,59,59,0.12);}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);}
.timer{font-size:2rem;margin:12px 0;color:var(--neon-green);font-weight:800;text-shadow:0 0 10px rgba(57,255,20,0.12);}
.meta{color:var(--muted);font-size:.9rem;}
.settings-row{display:flex;flex-direction:column;gap:8px;}
.small-input{padding:8px;border-radius:8px;border:0;background:#0b1114;color:#e6eef3;}
footer.note{color:var(--muted);font-size:.86rem;margin-top:10px;text-align:center;}
#ex-video{width:100%;height:220px;border-radius:10px;border:0;background:#000;object-fit:contain;}
@media(min-width:720px){#ex-video{height:360px;}}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">J</div>
    <div>
      <h1>JasoNowitzki Daily Knee Routine</h1>
      <div class="lead">Workout ‚Ä¢ Progress ‚Ä¢ Settings ‚Äî Syncs to Google Sheets automatically when online</div>
    </div>
  </header>

  <!-- Panels -->
  <div id="panel-workout" class="panel active card">
    <div id="exercise-title" style="display:flex;justify-content:space-between;align-items:center">
      <strong id="ex-name">Wall Sit</strong>
      <div id="ex-count" class="meta">1/1</div>
    </div>
    <img id="ex-video" src="" alt="Exercise GIF">
    <div class="meta" id="ex-instr">Instruction</div>
    <div class="timer" id="ex-timer">Ready</div>
    <div class="row">
      <button class="btn blue" id="startBtn">Start</button>
      <button class="btn ghost" id="markBtn">Mark Done</button>
      <button class="btn" id="pauseBtn">Pause</button>
    </div>
    <div class="row" style="margin-top:12px">
      <button class="btn ghost" id="prevBtn">Prev</button>
      <button class="btn blue" id="nextBtn">Next</button>
    </div>
    <div id="rest-area" style="display:none;margin-top:12px" class="card">
      <div style="font-weight:800;color:var(--neon-blue)">Rest</div>
      <div class="timer" id="rest-timer">30s</div>
      <div class="row">
        <button class="btn ghost" id="skipRest">Skip Rest</button>
        <button class="btn red" id="skipRestRed">Skip Rest</button>
      </div>
    </div>
  </div>

  <div id="panel-progress" class="panel card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Progress Timeline</strong>
      <button class="btn ghost" id="syncNowBtn">Sync Now</button>
    </div>
    <div id="timelineList" style="margin-top:10px"></div>
    <footer class="note">Entries are saved locally and synced automatically when you're online.</footer>
  </div>

  <div id="panel-settings" class="panel card">
    <strong>Settings</strong>
    <div class="settings-row" style="margin-top:8px">
      <label class="meta">Google Sheets API Endpoint</label>
      <input id="apiUrl" class="small-input" placeholder="https://script.google.com/macros/s/.../exec"/>
      <label class="meta">Secret</label>
      <input id="apiSecret" class="small-input" placeholder="a-secret-token"/>
      <label class="meta">Beep Sound</label>
      <select id="beepToggle" class="small-input"><option value="on">On</option><option value="off">Off</option></select>
      <label class="meta">Theme</label>
      <select id="themeToggle" class="small-input"><option value="dark">Dark Neon</option><option value="light">Light</option></select>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="clearData" class="btn red">Clear Local Data</button>
        <button id="exportData" class="btn ghost">Export CSV</button>
      </div>
      <div class="meta" style="margin-top:8px">Sync status: <span id="syncStatus">idle</span></div>
    </div>
  </div>

  <footer style="height:78px"></footer>

  <!-- bottom tabs -->
  <div class="tabs">
    <button class="tab-btn active" id="tabWorkout">üèãÔ∏è Workout</button>
    <button class="tab-btn" id="tabProgress">üìÖ Progress</button>
    <button class="tab-btn" id="tabSettings">‚öôÔ∏è Settings</button>
  </div>
</div>

<script>
// ================= DATA =================
const EXERCISES=[
{name:'Wall Sit',gif:'https://media.giphy.com/media/l0HlOvJ7yaacpuSas/giphy.gif',instr:'Back flat, knees ~90¬∞.',hold:10},
{name:'Glute Bridge',gif:'https://media.giphy.com/media/3o7TKM4k1IuMFfJdU0/giphy.gif',instr:'Drive through heels.',hold:8},
{name:'Straight Leg Raise',gif:'https://media.giphy.com/media/l41lY2l1tX4KDXB7C/giphy.gif',instr:'Keep thigh pressed.',hold:8},
{name:'Clamshell',gif:'https://media.giphy.com/media/l0HlXo5s3WItT2GzO/giphy.gif',instr:'Keep feet touching.',hold:8},
{name:'Mini Squat',gif:'https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif',instr:'Push hips back slightly.',hold:8},
{name:'Hip Abduction',gif:'https://media.giphy.com/media/3og0IUE6zKocxV6hR6/giphy.gif',instr:'Lift leg with control.',hold:8},
{name:'Calf Raises',gif:'https://media.giphy.com/media/3o6ZsXxMMLp8nRmZ84/giphy.gif',instr:'Rise fully onto toes.',hold:8},
{name:'Single-Leg Balance',gif:'https://media.giphy.com/media/l0HlWkE39y5PtD6ze/giphy.gif',instr:'Stand tall, soft knee.',hold:8}
];

// ...rest of your original JavaScript below (unchanged)

const LS_KEYS={LOGS:'jn_logs',QUEUE:'jn_queue',SETTINGS:'jn_settings'};
const $=s=>document.querySelector(s);
function uid(){return 'id_'+Date.now()+'_'+Math.floor(Math.random()*10000);}
function nowISO(){return (new Date()).toISOString();}
function todayDate(){return (new Date()).toISOString().slice(0,10);}
function loadJSON(k,f){try{const v=localStorage.getItem(k);return v?JSON.parse(v):f}catch(e){return f;}}
function saveJSON(k,v){localStorage.setItem(k,JSON.stringify(v));}
if(!loadJSON(LS_KEYS.LOGS, null)) saveJSON(LS_KEYS.LOGS, []);
if(!loadJSON(LS_KEYS.QUEUE, null)) saveJSON(LS_KEYS.QUEUE, []);
if(!loadJSON(LS_KEYS.SETTINGS, null)) saveJSON(LS_KEYS.SETTINGS,{apiUrl:'',secret:'',beep:'on',theme:'dark'});

// ================= SYNC =================
let syncing=false;
async function tryAutoSync(){
  const st = loadJSON(LS_KEYS.SETTINGS,{});
  const apiUrl = st.apiUrl, secret = st.secret;
  const queue = loadJSON(LS_KEYS.QUEUE,[]);

  if(!navigator.onLine || !apiUrl || queue.length===0 || syncing) return;

  syncing = true;
  $('#syncStatus').textContent = 'syncing...';

  for(const item of queue.slice()){
    try{
      const resp = await fetch(apiUrl, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({secret, payload:item})
      });

      if(!resp.ok){
        console.warn('Sync failed, server returned', resp.status);
        continue;
      }

      const logs = loadJSON(LS_KEYS.LOGS,[]);
      const found = logs.find(l => l.id === item.id);
      if(found) found.synced = true;
      saveJSON(LS_KEYS.LOGS,logs);

      let q = loadJSON(LS_KEYS.QUEUE,[]);
      q = q.filter(x => x.id !== item.id);
      saveJSON(LS_KEYS.QUEUE,q);

    } catch(e){
      console.warn('Sync error (likely CORS or network):', e);
      break;
    }
  }

  syncing = false;
  $('#syncStatus').textContent = 'idle';
  renderTimeline();
}
$('#syncNowBtn').addEventListener('click',tryAutoSync);
window.addEventListener('online',tryAutoSync);

// ================= TABS =================
const panels={workout:$('#panel-workout'),progress:$('#panel-progress'),settings:$('#panel-settings')};
function setActiveTab(tab){
  Object.values(panels).forEach(p=>p.classList.remove('active'));
  $('#tabWorkout').classList.remove('active'); $('#tabProgress').classList.remove('active'); $('#tabSettings').classList.remove('active');
  panels[tab].classList.add('active'); $('#tab'+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add('active');
  if(tab==='progress') renderTimeline(); if(tab==='settings') loadSettingsToUI();
}
$('#tabWorkout').addEventListener('click',()=>setActiveTab('workout'));
$('#tabProgress').addEventListener('click',()=>setActiveTab('progress'));
$('#tabSettings').addEventListener('click',()=>setActiveTab('settings'));

// ================= WORKOUT =================
let currentIndex=0,exTimer=null,restTimer=null,exTimeLeft=0,exerciseActive=false,restActive=false;
function loadExercise(idx=0){
  currentIndex=idx; const ex=EXERCISES[currentIndex];
  $('#ex-name').textContent=ex.name;
  $('#ex-count').textContent=(currentIndex+1)+'/'+EXERCISES.length;
  $('#ex-video').src=ex.gif;
  $('#ex-instr').textContent=ex.instr;
  $('#ex-timer').textContent='Ready';
  $('#rest-area').style.display='none';
  startBtnEnable(true);
}
function startBtnEnable(enabled){$('#startBtn').disabled=!enabled; $('#markBtn').disabled=!enabled;}
function startExercise(){
  const ex=EXERCISES[currentIndex]; exTimeLeft=ex.hold; $('#ex-timer').textContent=exTimeLeft+'s'; startBtnEnable(false); exerciseActive=true;
  if(exTimer) clearInterval(exTimer);
  exTimer=setInterval(()=>{if(!exerciseActive) return; exTimeLeft--; $('#ex-timer').textContent=exTimeLeft>0?exTimeLeft+'s':'Done!'; if(exTimeLeft<=0){clearInterval(exTimer);exerciseActive=false; onExerciseComplete();}},1000);
}
$('#startBtn').addEventListener('click',startExercise);
$('#markBtn').addEventListener('click',()=>{if(exTimer){clearInterval(exTimer);exerciseActive=false;} onExerciseComplete();});
$('#prevBtn').addEventListener('click',()=>{if(currentIndex>0) loadExercise(currentIndex-1);});
$('#nextBtn').addEventListener('click',()=>{if(exTimer){clearInterval(exTimer);exerciseActive=false;} startRestCountdown();});
$('#pauseBtn').addEventListener('click',pauseWorkout);
function pauseWorkout(){
  exerciseActive=false; restActive=false; if(exTimer) clearInterval(exTimer); if(restTimer) clearInterval(restTimer);
  const keep=confirm('Paused ‚Äî OK resume, Cancel restart.'); if(keep){const left=parseInt($('#ex-timer').textContent,10); if(!isNaN(left)&&left>0){exTimeLeft=left; startExercise();}} else{loadExercise(0);}}
function onExerciseComplete(){
  const duration=EXERCISES[currentIndex].hold;
  const log={id:uid(),timestamp:nowISO(),date:todayDate(),exerciseIndex:currentIndex,exerciseName:EXERCISES[currentIndex].name,duration,status:'completed',note:'',synced:false};
  const note=prompt('Quick note (short):',''); if(note!==null) log.note=note.substring(0,300);
  const logs=loadJSON(LS_KEYS.LOGS,[]); logs.unshift(log); saveJSON(LS_KEYS.LOGS,logs);
  const q=loadJSON(LS_KEYS.QUEUE,[]); q.push(log); saveJSON(LS_KEYS.QUEUE,q);
  tryAutoSync(); startRestCountdown();
}
function startRestCountdown(){
  $('#rest-area').style.display='block';
  let left=30; $('#rest-timer').textContent=left+'s'; restActive=true;
  $('#skipRest').onclick=skipRestHandler; $('#skipRestRed').onclick=skipRestHandler;
  if(restTimer) clearInterval(restTimer);
  restTimer=setInterval(()=>{if(!restActive) return; left--; $('#rest-timer').textContent=left+'s'; if(left<=0){clearInterval(restTimer);restActive=false; $('#rest-area').style.display='none'; nextExercise();}},1000);
}
function skipRestHandler(){if(restTimer) clearInterval(restTimer);restActive=false; $('#rest-area').style.display='none'; nextExercise();}
function nextExercise(){if(currentIndex<EXERCISES.length-1) loadExercise(currentIndex+1); else alert('All done for today!');}
loadExercise();

// ================= PROGRESS =================
function renderTimeline(){
  const logs=loadJSON(LS_KEYS.LOGS,[]);
  const container=$('#timelineList'); container.innerHTML='';
  if(logs.length===0){container.textContent='No entries yet.'; return;}
  logs.forEach(l=>{
    const div=document.createElement('div'); div.className='card';
    div.innerHTML=`<strong>${l.exerciseName}</strong> (${l.duration}s) <span class="meta">${l.date} ${l.timestamp.slice(11,19)}</span>${l.synced?' ‚úÖ':''}${l.note?'<br>'+l.note:''}`;
    container.appendChild(div);
  });
}

// ================= SETTINGS =================
function loadSettingsToUI(){
  const st=loadJSON(LS_KEYS.SETTINGS,{});
  $('#apiUrl').value=st.apiUrl||''; $('#apiSecret').value=st.secret||''; $('#beepToggle').value=st.beep||'on'; $('#themeToggle').value=st.theme||'dark';
}
$('#apiUrl,#apiSecret,#beepToggle,#themeToggle').addEventListener('change',()=>{saveSettingsFromUI();});
function saveSettingsFromUI(){
  const st={apiUrl:$('#apiUrl').value,secret:$('#apiSecret').value,beep:$('#beepToggle').value,theme:$('#themeToggle').value};
  saveJSON(LS_KEYS.SETTINGS,st);
}

// Clear and Export
$('#clearData').onclick=()=>{if(confirm('Erase all local data?')){localStorage.clear(); location.reload();}};
$('#exportData').onclick=()=>{const logs=loadJSON(LS_KEYS.LOGS,[]); const csv=logs.map(l=>[l.date,l.timestamp,l.exerciseName,l.duration,l.status,l.note].join(',')).join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='jn_logs.csv'; a.click();};

</script>
</body>
</html>
