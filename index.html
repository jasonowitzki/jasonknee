<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JasoNowitzki Daily Knee Routine</title>
<link rel="manifest" href="manifest.json" />
<style>
  :root{
    --bg:#0d1117; --card:#10151b; --neon-blue:#00bfff; --neon-green:#39ff14; --neon-red:#ff3b3b;
    --muted:#9aa6b2;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,var(--bg) 0%,#07121a 100%);color:#e6eef3}
  .app{max-width:720px;margin:0 auto;padding:12px;display:flex;flex-direction:column;min-height:100vh}
  header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(180deg,var(--neon-blue),#00d4ff);display:flex;align-items:center;justify-content:center;font-weight:800;color:#041617}
  h1{margin:0;font-size:1.05rem;color:var(--neon-blue)}
  .lead{color:var(--muted);font-size:.92rem;margin-top:4px}
  .card{background:linear-gradient(180deg,var(--card),#0b1216);border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
  .tabs{display:flex;gap:6px;position:fixed;left:0;right:0;bottom:10px;max-width:720px;margin:auto;padding:8px;background:transparent;justify-content:space-around}
  .tab-btn{flex:1;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);color:var(--muted);font-weight:700}
  .tab-btn.active{background:linear-gradient(90deg,var(--neon-blue),var(--neon-green));color:#011;box-shadow:0 8px 30px rgba(0,191,255,0.12)}
  .panel{display:none;flex:1;min-height:60vh;margin-bottom:70px}
  .panel.active{display:block}
  iframe{width:100%;height:220px;border-radius:10px;border:0;background:#000}
  .instr{margin-top:8px;color:var(--muted)}
  .timer{font-size:2rem;margin:12px 0;color:var(--neon-green);font-weight:800;text-shadow:0 0 10px rgba(57,255,20,0.12)}
  .btn{padding:10px;border-radius:10px;border:0;font-weight:700;cursor:pointer}
  .btn.blue{background:var(--neon-blue);color:#031;box-shadow:0 8px 28px rgba(0,191,255,0.12)}
  .btn.red{background:var(--neon-red);color:#201010;box-shadow:0 8px 28px rgba(255,59,59,0.12)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .row{display:flex;gap:8px;margin-top:10px}
  .timeline-item{display:flex;flex-direction:column;padding:8px;border-radius:10px;margin-bottom:8px;background:rgba(255,255,255,0.02)}
  .meta{color:var(--muted);font-size:.9rem}
  .settings-row{display:flex;flex-direction:column;gap:8px}
  .small-input{padding:8px;border-radius:8px;border:0;background:#0b1114;color:#e6eef3}
  footer.note{color:var(--muted);font-size:.86rem;margin-top:10px;text-align:center}
  @media(min-width:720px){iframe{height:360px}}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">J</div>
    <div>
      <h1>JasoNowitzki Daily Knee Routine</h1>
      <div class="lead">Workout ‚Ä¢ Progress ‚Ä¢ Settings ‚Äî Syncs to Google Sheets automatically when online</div>
    </div>
  </header>

  <!-- Panels -->
  <div id="panel-workout" class="panel active card">
    <div id="workout-stage">
      <div id="exercise-title" style="display:flex;justify-content:space-between;align-items:center">
        <strong id="ex-name">Wall Sit</strong>
        <div id="ex-count" class="meta">1/1</div>
      </div>

      <iframe id="ex-video" src=""></iframe>
      <div class="instr" id="ex-instr">Instruction</div>
      <div class="timer" id="ex-timer">Ready</div>

      <div class="row">
        <button class="btn blue" id="startBtn">Start</button>
        <button class="btn ghost" id="markBtn">Mark Done</button>
        <button class="btn" id="pauseBtn">Pause</button>
      </div>
      <div style="margin-top:12px" class="row">
        <button class="btn ghost" id="prevBtn">Prev</button>
        <button class="btn blue" id="nextBtn">Next</button>
      </div>
      <div id="rest-area" style="display:none;margin-top:12px" class="card">
        <div style="font-weight:800;color:var(--neon-blue)">Rest</div>
        <div class="timer" id="rest-timer">30s</div>
        <div class="row">
          <button class="btn ghost" id="skipRest">Skip Rest</button>
          <button class="btn red" id="skipRestRed">Skip Rest</button>
        </div>
      </div>
    </div>
  </div>

  <div id="panel-progress" class="panel card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Progress Timeline</strong>
      <button class="btn ghost" id="syncNowBtn">Sync Now</button>
    </div>
    <div id="timelineList" style="margin-top:10px"></div>
    <footer class="note">Entries are saved locally and synced automatically when you're online.</footer>
  </div>

  <div id="panel-settings" class="panel card">
    <strong>Settings</strong>
    <div class="settings-row" style="margin-top:8px">
      <label class="meta">Google Sheets API Endpoint (Apps Script Web App URL)</label>
      <input id="apiUrl" class="small-input" placeholder="https://script.google.com/macros/s/XXXXXXXX/exec" />
      <label class="meta">Secret (must match Apps Script SECRET)</label>
      <input id="apiSecret" class="small-input" placeholder="a-secret-token" />
      <label class="meta">Beep Sound</label>
      <select id="beepToggle" class="small-input">
        <option value="on">On</option><option value="off">Off</option>
      </select>
      <label class="meta">Theme</label>
      <select id="themeToggle" class="small-input">
        <option value="dark">Dark Neon</option><option value="light">Light</option>
      </select>
      <div style="display:flex;gap:8px">
        <button id="clearData" class="btn red">Clear Local Data</button>
        <button id="exportData" class="btn ghost">Export CSV</button>
      </div>
      <div class="meta" style="margin-top:8px">Sync status: <span id="syncStatus">idle</span></div>
    </div>
  </div>

  <footer style="height:78px"></footer>
  <!-- bottom tabs -->
  <div class="tabs">
    <button class="tab-btn active" id="tabWorkout">üèãÔ∏è Workout</button>
    <button class="tab-btn" id="tabProgress">üìÖ Progress</button>
    <button class="tab-btn" id="tabSettings">‚öôÔ∏è Settings</button>
  </div>
</div>

<script>
/* =========================
   App Data & Config
========================= */

const EXERCISES = [
  { name:'Wall Sit', id:'cWTZ8Am1Ee0', instr:'Back flat against wall, knees at ~90¬∞. Keep knees from collapsing inward.', hold:45 },
  { name:'Glute Bridge', id:'tZKt9S_xFDA', instr:'Drive through heels and squeeze glutes at top.', hold:40 },
  { name:'Straight Leg Raise', id:'MGLFUBvbymI', instr:'Keep thigh pressed to the floor. Lift slowly.', hold:40 },
  { name:'Clamshell', id:'DAAjOdwZdks', instr:'Keep feet touching, lift the top knee without rotating pelvis.', hold:40 },
  { name:'Mini Squat', id:'XNe_Kgw6860', instr:'Push hips back slightly, knees track over toes.', hold:40 },
  { name:'Hip Abduction', id:'-t7fuZ0KhDA', instr:'Lift leg with control, avoid rotating your torso.', hold:40 },
  { name:'Calf Raises', id:'YMmgqO8Jo-k', instr:'Rise fully onto toes, lower slowly.', hold:40 },
  { name:'Single-Leg Balance', id:'MzgmUDGRQC0', instr:'Stand tall, soft knee, focus on a fixed point.', hold:30 }
];

const LS_KEYS = {
  LOGS: 'jn_logs',
  QUEUE: 'jn_queue',
  SETTINGS: 'jn_settings'
};

const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function uid(){ return 'id_'+Date.now()+'_'+Math.floor(Math.random()*10000); }
function nowISO(){ return (new Date()).toISOString(); }
function todayDate(){ return (new Date()).toISOString().slice(0,10); }

function loadJSON(k, fallback){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):fallback; }catch(e){return fallback;} }
function saveJSON(k, v){ localStorage.setItem(k, JSON.stringify(v)); }

if(!loadJSON(LS_KEYS.LOGS, null)) saveJSON(LS_KEYS.LOGS, []);
if(!loadJSON(LS_KEYS.QUEUE, null)) saveJSON(LS_KEYS.QUEUE, []);
if(!loadJSON(LS_KEYS.SETTINGS, null)) saveJSON(LS_KEYS.SETTINGS, { apiUrl:'', secret:'', beep:'on', theme:'dark' });

/* ====== Sync manager (unified) ====== */
let syncing=false;
async function tryAutoSync(){
  const settings=loadJSON(LS_KEYS.SETTINGS,{});
  const apiUrl=settings.apiUrl;
  const secret=settings.secret;
  const queue=loadJSON(LS_KEYS.QUEUE,[]);

  if(!navigator.onLine){ $('#syncStatus').textContent='offline'; return; }
  if(!apiUrl || queue.length===0){ $('#syncStatus').textContent='idle'; return; }
  if(syncing) return;
  syncing=true;
  $('#syncStatus').textContent='syncing...';

  let successCount=0;
  let failCount=0;

  for(const item of queue.slice()){
    try{
      const resp=await fetch(apiUrl,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({secret:secret,payload:item})
      });
      const result=await resp.json();
      if(result.status==='success'){
        successCount++;
        const logs=loadJSON(LS_KEYS.LOGS,[]);
        const found=logs.find(l=>l.id===item.id);
        if(found) found.synced=true;
        saveJSON(LS_KEYS.LOGS,logs);
        let q=loadJSON(LS_KEYS.QUEUE,[]);
        q=q.filter(x=>x.id!==item.id);
        saveJSON(LS_KEYS.QUEUE,q);
      } else { failCount++; console.warn('sync failed',result.message); }
    }catch(err){ failCount++; console.warn('sync error',err); }
  }

  syncing=false;
  $('#syncStatus').textContent=`Done. Success: ${successCount}, Fail: ${failCount}`;
  renderTimeline();
  if(failCount>0) alert('Some items failed to sync. Check console.');
}

window.addEventListener('online',tryAutoSync);
$('#syncNowBtn').addEventListener('click',tryAutoSync);

/* =========================
   UI Tabs & workout logic unchanged
========================= */

// ...keep the rest of your script exactly as is: workout timers, progress, settings, audio, init, etc.

</script>
</body>
</html>
